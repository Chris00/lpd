<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Socket (lpd.Socket)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">lpd</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Socket</span></h1></header><p>Buffered sockets (Pervasive like functions for sockets working on
all platforms).</p><p>This library is distributed under the terms of the GNU Lesser
General Public License, with the special exception on linking as
for the OCaml Library.</p><ul class="at-tag"><li><span class="at-tag author">Author</span>: Christophe Troestler</li><li><span class="at-tag version">Version</span>: 1.2.2</li></ul><div class="spec type" id="type-in_channel"><a href="#type-in_channel" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>in_channel</code><code></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-out_channel"><a href="#type-out_channel" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>out_channel</code><code></code><code></code></div><div class="doc"><p>Abstract types for buffered sockets.</p></div></div><div class="spec val" id="val-in_channel_of_descr"><a href="#val-in_channel_of_descr" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>in_channel_of_descr : Unix.file_descr <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-in_channel">in_channel</a></code></div><div class="doc"><p>Create an input channel reading from the given descriptor.</p></div></div><div class="spec val" id="val-out_channel_of_descr"><a href="#val-out_channel_of_descr" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>out_channel_of_descr : Unix.file_descr <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-out_channel">out_channel</a></code></div><div class="doc"><p>Create an output channel writing on the given descriptor.</p></div></div><div class="spec val" id="val-descr_of_in_channel"><a href="#val-descr_of_in_channel" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>descr_of_in_channel : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> Unix.file_descr</code></div><div class="doc"><p>Return the descriptor corresponding to an input channel.</p></div></div><div class="spec val" id="val-descr_of_out_channel"><a href="#val-descr_of_out_channel" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>descr_of_out_channel : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> Unix.file_descr</code></div><div class="doc"><p>Return the descriptor corresponding to an output channel.</p></div></div><h3>High-level network connection functions</h3><div class="spec val" id="val-open_connection"><a href="#val-open_connection" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>open_connection : Unix.sockaddr <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-in_channel">in_channel</a><span class="keyword"> * </span><a href="index.html#type-out_channel">out_channel</a></code></div><div class="doc"><p>Connect to a server at the given address.
Return a buffered socket.
Can raise the same exceptions as <code class="code">Unix.open_connection</code>.</p></div></div><div class="spec val" id="val-shutdown_connection"><a href="#val-shutdown_connection" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>shutdown_connection : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>``Shut down'' a connection established with
<a href="index.html#val-open_connection">Socket.open_connection</a>; that is, transmit an end-of-file
condition to the server reading on the other side of the
connection. (You should flush the out_channels connected to the
same socket if you want to make sure all data is transmitted.)</p></div></div><h3>Output functions</h3><div class="spec val" id="val-output"><a href="#val-output" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">output oc buf pos len</code> writes <code class="code">len</code> characters from string
<code class="code">buf</code>, starting at offset <code class="code">pos</code>, to the given buffered socket <code class="code">oc</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: &quot;Socket.output&quot; if <code class="code">pos</code> and <code class="code">len</code> do not
designate a valid substring of <code class="code">buf</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">output</code>
would block.</li></ul></div></div><div class="spec val" id="val-output_char"><a href="#val-output_char" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_char : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> char <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Write the character on the given buffered socket.</p></div></div><div class="spec val" id="val-output_string"><a href="#val-output_string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_string : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Write the string on the given buffered socket.</p></div></div><div class="spec val" id="val-fprintf"><a href="#val-fprintf" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>fprintf : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) Pervasives.format4 <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p><code class="code">fprintf oc format arguments</code> is like <code class="code">Printf.fprintf</code> except
that <code class="code">oc</code> is a buffered socket.</p></div></div><div class="spec val" id="val-flush"><a href="#val-flush" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>flush : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p>Flush the output buffer associated with the given buffered
socket.</p></div></div><div class="spec val" id="val-close_out"><a href="#val-close_out" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>close_out : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">close_out oc</code> closes the socket <code class="code">oc</code>, flushing all buffered
write operations. (This closes the underlying file descriptor as
well.) Output functions raise a <code class="code">Sys_error</code> exception when they
are applied to a closed output channel, except <code class="code">close_out</code> and
<code class="code">flush</code> which do nothing.</p></div></div><h3>Input functions</h3><div class="spec val" id="val-input"><a href="#val-input" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">input ic buf pos len</code> reads up to <code class="code">len</code> characters from the
given socket <code class="code">ic</code>, storing them in string <code class="code">buf</code>, starting at
character number <code class="code">pos</code>. It returns the actual number of
characters read, between 0 and <code class="code">len</code> (inclusive).</p><p>A return value of 0 means that the end of file was reached.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: &quot;Socket.input&quot; if <code class="code">pos</code> and <code class="code">len</code> do not
designate a valid substring of <code class="code">buf</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">input</code>
would block (no characters are then read).</li></ul></div></div><div class="spec val" id="val-input_char"><a href="#val-input_char" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_char : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> char</code></div><div class="doc"><p>Read one character from the given input channel.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">End_of_file</span>: if there are no more characters to read.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">input_char</code>
would block (no characters are then read).</li></ul></div></div><div class="spec val" id="val-really_input"><a href="#val-really_input" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>really_input : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">really_input ic buf pos len</code> reads <code class="code">len</code> characters from the
buffered socket <code class="code">ic</code>, storing them in string <code class="code">buf</code>, starting at
character number <code class="code">pos</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">End_of_file</span>: if the end of file is reached before <code class="code">len</code>
characters have been read.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: &quot;Socket.really_read&quot; if <code class="code">pos</code> and <code class="code">len</code>
do not designate a valid substring of <code class="code">buf</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">really_input</code>
would block (the characters that may have been read are lost).</li></ul></div></div><div class="spec val" id="val-input_line"><a href="#val-input_line" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_line : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">input_line ic</code> returns the next line from the socket <code class="code">ic</code>
without the final '\n'.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">End_of_file</span>: if the end of the file is reached.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and
<code class="code">input_line</code> would block (the characters that may have been read
are lost).</li></ul></div></div><div class="spec val" id="val-input_till"><a href="#val-input_till" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_till : char <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> Bytes.t <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">input_till c ic buf pos len</code> reads up to <code class="code">len</code> characters
different from <code class="code">c</code> from the socket <code class="code">ic</code>, storing them in string
<code class="code">buf</code>, starting at character number <code class="code">pos</code>. The return value is
the actual number of characters read (different from <code class="code">c</code>), between
0 and <code class="code">len</code> (inclusive). If <code class="code">c</code> is encountered, the reading
stops. <code class="code">c</code> is left in the input stream; thus all further
<code class="code">input_till</code> commands will return <code class="code">0</code>.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">End_of_file</span>: if the end of the file is reached (i.e.,
there are no more characters to read). This is different from the
return value being <code class="code">0</code> -- the latter indicating that the first
character in the stream is <code class="code">c</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: &quot;Socket.input_till&quot; if <code class="code">pos</code> and <code class="code">len</code>
do not designate a valid substring of <code class="code">buf</code>.</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">input_till</code>
would block (no characters are then read).</li></ul></div></div><div class="spec val" id="val-input_all_till"><a href="#val-input_all_till" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_all_till : char <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">input_all_till c ic</code> returns the next chunk from the socket
<code class="code">ic</code> from the current position to the character <code class="code">c</code> (excluded) or
the end of the file. The character <code class="code">c</code> is read and discarded.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">End_of_file</span>: if the end of the file is reached before any
character can be read. (This is different from an empty string
being returned which indicates that <code class="code">c</code> is the first character in
the input stream.)</li><li><span class="at-tag raise">Raises</span> <span class="module-path">Sys_blocked_io</span>: if we are in non-blocking mode and <code class="code">input_all_till</code>
would block (the characters that may have been read are lost).</li></ul></div></div><div class="spec val" id="val-close_in"><a href="#val-close_in" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>close_in : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">close_in ic</code> closes the socket <code class="code">ic</code>. (This closes the
underlying file descriptor as well.) Input functions raise a
<code class="code">Sys_error</code> exception when they are applied to a closed input
channel, except <code class="code">close_in</code>, which does nothing when applied to an
already closed channel.</p></div></div><h3>Polling</h3><div class="spec val" id="val-select"><a href="#val-select" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>select : <a href="index.html#type-in_channel">in_channel</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-out_channel">out_channel</a> list <span class="keyword">&#8209;&gt;</span> float <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-in_channel">in_channel</a> list<span class="keyword"> * </span><a href="index.html#type-out_channel">out_channel</a> list</code></div><div class="doc"><p><code class="code">select inl outl t</code> waits at most <code class="code">t</code> seconds until some
input/output operations become possible on some channels among
<code class="code">inl</code> and <code class="code">outl</code>. A negative <code class="code">t</code> means unbounded wait. The
result is composed of two sets of channels: those ready for
reading (first component) and those ready for writing (second
component).</p></div></div><h3>I/O objects</h3><p>I/O objects for the channels respecting the conventions for
<a href="http://ocaml-programming.de/rec/IO-Classes.html">IO-Classes</a>. The
objects only give another access to the channels and their methods
can be interspersed with the above function calls.</p><div class="spec class" id="class-out_channel_obj"><a href="#class-out_channel_obj" class="anchor"></a><div class="def class"><code><span class="keyword">class </span><a href="class-out_channel_obj/index.html">out_channel_obj</a> : <a href="index.html#type-out_channel">out_channel</a> <span class="keyword">&#8209;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec class" id="class-in_channel_obj"><a href="#class-in_channel_obj" class="anchor"></a><div class="def class"><code><span class="keyword">class </span><a href="class-in_channel_obj/index.html">in_channel_obj</a> : <a href="index.html#type-in_channel">in_channel</a> <span class="keyword">&#8209;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div></body></html>